---
apiVersion: v1
kind: Namespace
metadata:
  name: vault-test
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vault
  namespace: vault-test
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: vault-config
  namespace: vault-test
data:
  vault.hcl: |
    ui = true
    listener "tcp" {
      address = "0.0.0.0:8200"
      tls_disable = 1
    }
    storage "file" {
      path = "/vault/data"
    }
    disable_mlock = true
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vault
  namespace: vault-test
spec:
  replicas: 1
  selector:
    matchLabels:
      app: vault
  template:
    metadata:
      labels:
        app: vault
    spec:
      serviceAccountName: vault
      securityContext:
        fsGroup: 1000
      containers:
	    - name: vault
          image: icr.io/ppc64le-oss/vault-ppc64le:v1.14.8
		  args:
		    - "server"
			- "-config=/vault/config/vault.hcl"
          ports:
		    - containerPort: 8200
          env:
		    - name: VAULT_ADDR
              value: "http://127.0.0.1:8200"
			- name: VAULT_DEV_ROOT_TOKEN_ID
			  value: "${VAULT_ROOT_TOKEN}"
          volumeMounts:
		    - name: config
              mountPath: /vault/config
			- name: data
              mountPath: /vault/data
	
      volumes:
	    - name: config
          configMap:
            name: vault-config
		- name: data
          emptyDir: {}
---
apiVersion: v1
kind: Service
metadata:
  name: vault
  namespace: vault-test
spec:
  selector:
    app: vault
  ports:
name: http
      port: 8200
      targetPort: 8200